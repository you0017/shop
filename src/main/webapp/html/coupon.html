<!DOCTYPE html>
<html class="no-js" lang="zxx">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>优惠券领取</title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="shortcut icon" type="image/x-icon" href="assets/images/favicon.svg" />

    <!-- ========================= CSS here ========================= -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css" />
    <link rel="stylesheet" href="assets/css/LineIcons.3.0.css" />
    <link rel="stylesheet" href="assets/css/tiny-slider.css" />
    <link rel="stylesheet" href="assets/css/glightbox.min.css" />
    <link rel="stylesheet" href="assets/css/main.css" />

	<style>
		body {
		    font-family: Arial, sans-serif;
		    background-color: #f8f9fa;
		    margin: 0;
		    padding: 0;
		}
		
		.container1 {
		    margin: 20px;
		}
		
		.container1 button, .container1 a {
		    text-decoration: none;
		    background-color: #007bff;
		    color: white;
		    border: none;
		    padding: 10px 20px;
		    cursor: pointer;
		    border-radius: 5px;
		}
		
		.container1 button:hover {
		    background-color: #0056b3;
		}
		
		#addressList .address-item {
		    border: 1px solid #ccc;
		    padding: 15px;
		    margin: 10px 0;
		    background-color: white;
		    border-radius: 5px;
		    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
		    position: relative;
		}
		
		.address-item .default-tag {
		    position: absolute;
		    top: 10px;
		    right: 10px;
		    background-color: #28a745;
		    color: white;
		    padding: 5px;
		    border-radius: 5px;
		    font-size: 12px;
		}
		
		.overlay {
		    display: none;
		    position: fixed;
		    top: 0;
		    left: 0;
		    width: 100%;
		    height: 100%;
		    background-color: rgba(0, 0, 0, 0.5);
		    justify-content: center;
		    align-items: center;
		}
		
		.form-container1 {
		    background: #fff;
		    padding: 20px;
		    border-radius: 10px;
		    width: 100%;
		    max-width: 800px;
		    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
		    position: relative;
		}
		
		.close-btn {
		    position: absolute;
		    top: 10px;
		    right: 10px;
		    cursor: pointer;
		    font-size: 24px;
		}
		
		.form-container1 h2 {
		    margin-top: 0;
		    text-align: center;
		}
		
		.form-container1 .form-row {
		    display: flex;
		    flex-wrap: wrap;
		    margin-bottom: 10px;
		}
		
		.form-container1 .form-row label {
		    width: 30%;
		    padding-right: 10px;
		    box-sizing: border-box;
		}
		
		.form-container1 .form-row input, .form-container1 .form-row select {
		    width: 70%;
		    padding: 8px;
		    box-sizing: border-box;
		    border: 1px solid #ccc;
		    border-radius: 5px;
		}
		
		.form-container1 .form-row.full-width {
		    flex-basis: 100%;
		}
		
		.form-container1 .form-row input:focus, .form-container1 .form-row select:focus {
		    border-color: #007bff;
		    outline: none;
		}
		
		.form-container1 button {
		    background-color: #007bff;
		    color: white;
		    border: none;
		    cursor: pointer;
		    padding: 10px;
		    border-radius: 5px;
		    width: 100%;
		}
		
		.form-container1 button:hover {
		    background-color: #0056b3;
		}


        .coupon {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
            background-color: #f9f9f9;
            border-radius: 5px;
        }

        .coupon h3 {
            margin-top: 0;
        }

        .coupon p {
            margin: 5px 0;
        }
        .coupon button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin-top: 10px;
            cursor: pointer;
            border-radius: 5px;
        }

        .coupon button:hover {
            background-color: #45a049;
        }
	</style>
    <style>
        #c p:hover{
            cursor: pointer;
            border: 1px blue solid;
            background-color: aliceblue;
        }
    </style>
</head>

<body>
    <div id="app">
        <!--[if lte IE 9]>
        <p class="browserupgrade">
            You are using an <strong>outdated</strong> browser. Please
            <a href="https://browsehappy.com/">upgrade your browser</a> to improve
            your experience and security.
        </p>
        <![endif]-->

        <!-- Preloader -->
        <div class="preloader">
            <div class="preloader-inner">
                <div class="preloader-icon">
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>
        <!-- /End Preloader -->

        <!-- Start Header Area -->
        <header class="header navbar-area">
            <!-- Start Topbar -->
            <div class="topbar">
                <div class="container">
                    <div class="row align-items-center">
                        <div class="col-lg-4 col-md-4 col-12">
                        </div>
                        <div class="col-lg-4 col-md-4 col-12">
                            <div class="top-middle">
                                <ul class="useful-links">
                                    <li><a href="index.html">首页</a></li>
                                    <!--<li><a href="about-us.html">关于我们</a></li>-->
                                    <li><a href="contact.html">联系我们</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-12">
                            <div class="top-end">
                                <div class="user">
                                    <i class="lni lni-user"></i>
                                    你好
                                </div>
                                <ul class="user-login" v-if="!isLogin">
                                    <li>
                                        <a href="login.html">登录</a>
                                    </li>
                                    <li>
                                        <a href="register.html">注册</a>
                                    </li>
                                </ul>
                                <ul class="user-login" v-else>
                                    <li>
                                        {{username}}
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End Topbar -->
            <!-- Start Header Middle -->
            <div class="header-middle">
                <div class="container">
                    <div class="row align-items-center">
                        <div class="col-lg-3 col-md-3 col-7">
                            <!-- Start Header Logo -->
                            <a class="navbar-brand" href="index.html">
                                <img src="assets/images/logo/logo.svg" alt="Logo">
                            </a>
                            <!-- End Header Logo -->
                        </div>
                        <div class="col-lg-5 col-md-7 d-xs-none">
                            <!-- Start Main Menu Search -->
                            <div class="main-menu-search">
                                <!-- navbar search start -->
                                <div class="navbar-search search-style-5">
                                    <div class="search-input">
                                        <input type="text" @keyup="association" placeholder="搜索" v-model="searchItem">
                                        <div id='c' style="background-color: rgb(255, 255, 255); position: absolute; top: 45px; width: 480px; border: 1px solid rgb(226, 226, 226); box-shadow: rgba(0, 0, 0, 0.2) 0px 2px 5px; z-index: 1000;">
                                            <p v-for="(item,index) in associationList" @click="iSearch(item)">{{item}}</p>
                                        </div>
                                    </div>
                                    <div class="search-btn">
                                        <button @click="search()"><i class="lni lni-search-alt"></i></button>
                                    </div>
                                </div>
                                <!-- navbar search Ends -->
                            </div>
                            <!-- End Main Menu Search -->
                        </div>
                        <div class="col-lg-4 col-md-2 col-5">
                            <div class="middle-right-area">
                                <div class="nav-hotline">
                                    <i class="lni lni-phone"></i>
                                    <h3>热线电话:
                                        <span>{{phone}}</span>
                                    </h3>
                                </div>
                                <div class="navbar-cart">
                                    <div class="wishlist">
                                        <a href="javascript:void(0)">
                                            <i class="lni lni-heart"></i>
                                            <span class="total-items">0</span>
                                        </a>
                                    </div>
                                    <!-- 历史记录 -->
                                    <div class="cart-items">
                                        <a href="javascript:void(0)" class="main-btn">
                                            <i class="lni lni-cart"></i>
                                            <span class="total-items">{{history.length||0}}</span>
                                        </a>
                                        <!-- Shopping Item -->
                                        <div class="shopping-item">
                                            <div class="dropdown-cart-header">
                                                <span>历史记录</span>
                                                <a href="javascript:void(0)">历史记录</a>
                                            </div>
                                            <ul class="shopping-list">
                                                <li v-for="(item,index) in history">
                                                    <a href="javascript:void(0)" class="remove" title="Remove this item" @click="delHistoryById(item.id)"><i
                                                            class="lni lni-close"></i></a>
                                                    <div class="cart-img-head">
                                                        <a class="cart-img" href="product-details.html"><img
                                                                :src="item.image" alt="#"></a>
                                                    </div>
                                                    <div class="content">
                                                        <h4><a :href=`product-details.html?id=${item.id}`>
                                                            {{item.name}}</a></h4>
                                                    </div>
                                                </li>
                                            </ul>
                                            <div class="bottom">
                                                <div class="button">
                                                    <a href="javascript:void(0)" class="btn animate" @click="clearHistory()">清空记录</a>
                                                </div>
                                            </div>
                                        </div>
                                        <!--/ End Shopping Item -->
                                    </div>
                                    <div class="cart-items">
                                        <a href="javascript:void(0)" class="main-btn">
                                            <i class="lni lni-cart"></i>
                                            <span class="total-items">{{cart.num||0}}</span>
                                        </a>
                                        <!-- Shopping Item -->
                                        <div class="shopping-item">
                                            <div class="dropdown-cart-header">
                                                <span>{{cart.num}} Items</span>
                                                <a href="cart.html">查看购物车</a>
                                            </div>
                                            <ul class="shopping-list">
                                                <li v-for="(item,index) in cart.cartItems">
                                                    <a href="javascript:void(0)" class="remove" title="Remove this item" @click="removeItem(item.item.id)"><i
                                                            class="lni lni-close"></i></a>
                                                    <div class="cart-img-head">
                                                        <a class="cart-img" :href=`product-details.html?id=${item.item.id}`><img
                                                                :src="item.item.image" alt="#"></a>
                                                    </div>

                                                    <div class="content">
                                                        <h4><a :href=`product-details.html?id=${item.item.id}`>
                                                            {{item.item.name}}</a></h4>
                                                        <p class="quantity">{{item.num}}x - <span class="amount">￥{{item.item.price}}</span></p>
                                                    </div>
                                                </li>
                                            </ul>
                                            <div class="bottom">
                                                <div class="total">
                                                    <span>总</span>
                                                    <span class="total-amount">￥{{cart.total}}</span>
                                                </div>
                                                <div class="button">
                                                    <a href="checkout.html" class="btn animate">付款</a>
                                                </div>
                                            </div>
                                        </div>
                                        <!--/ End Shopping Item -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End Header Middle -->
            <!-- Start Header Bottom -->
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-8 col-md-6 col-12">
                        <div class="nav-inner">
                            <!-- Start Navbar -->
                            <nav class="navbar navbar-expand-lg">
                                <button class="navbar-toggler mobile-menu-btn" type="button" data-bs-toggle="collapse"
                                        data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                                        aria-expanded="false" aria-label="Toggle navigation">
                                    <span class="toggler-icon"></span>
                                    <span class="toggler-icon"></span>
                                    <span class="toggler-icon"></span>
                                </button>
                                <div class="collapse navbar-collapse sub-menu-bar" id="navbarSupportedContent">
                                    <ul id="nav" class="navbar-nav ms-auto">
                                        <li class="nav-item">
                                            <a href="index.html" class="" aria-label="Toggle navigation">首页</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="dd-menu collapsed active" href="javascript:void(0)" data-bs-toggle="collapse"
                                               data-bs-target="#submenu-1-2" aria-controls="navbarSupportedContent"
                                               aria-expanded="false" aria-label="Toggle navigation">页面</a>
                                            <ul class="sub-menu collapse" id="submenu-1-2">
                                                <li class="nav-item" v-if="isLogin"><a href="userinformation.html">个人信息修改</a></li>
                                                <li class="nav-item" v-if="isLogin"><a href="address.html">收货地址</a></li>
                                                <li class="nav-item" v-if="isLogin"><a href="order.html">历史订单</a></li>
                                                <li class="nav-item" v-if="isLogin"><a href="returnOrder.html">售后详情</a></li>
                                                <li class="nav-item active" v-if="isLogin"><a href="coupon.html">优惠券领取</a></li>
                                                <!--<li class="nav-item"><a href="about-us.html">关于我们</a></li>
                                                <li class="nav-item"><a href="faq.html">常见问题</a></li>-->
                                                <li class="nav-item">
                                                    <a href="login.html" v-if="!isLogin">登录</a>
                                                    <a href="javascript:" v-else @click="logout()">退出登录</a>
                                                </li>
                                                <li class="nav-item" v-if="!isLogin"><a href="register.html">注册</a></li>
                                                <!--<li class="nav-item"><a href="mail-success.html">邮件成功</a></li>
                                                <li class="nav-item"><a href="404.html">404 错误</a></li>-->
                                            </ul>
                                        </li>
                                        <li class="nav-item">
                                            <a class="dd-menu collapsed" href="javascript:void(0)" data-bs-toggle="collapse"
                                               data-bs-target="#submenu-1-3" aria-controls="navbarSupportedContent"
                                               aria-expanded="false" aria-label="Toggle navigation">商店</a>
                                            <ul class="sub-menu collapse" id="submenu-1-3">
                                                <li class="nav-item"><a href="product-grids.html">商店一览</a></li>
                                                <!--<li class="nav-item"><a href="product-list.html">店铺一览</a></li>
                                                <li class="nav-item"><a href="product-details.html">shop Single</a></li>-->
                                                <li class="nav-item"><a href="cart.html">购物车</a></li>
                                                <li class="nav-item"><a href="checkout.html">结账</a></li>
                                            </ul>
                                        </li>
                                        <li class="nav-item">
                                            <a href="contact.html" aria-label="Toggle navigation">在线客服</a>
                                        </li>
                                    </ul>
                                </div> <!-- navbar collapse -->
                            </nav>
                            <!-- End Navbar -->
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-6 col-12">
                        <!-- Start Nav Social -->
                        <div class="nav-social">
                            <h5 class="title">关注我们 :</h5>
                            <ul>
                                <li>
                                    <a href="javascript:void(0)"><i class="lni lni-facebook-filled"></i></a>
                                </li>
                                <li>
                                    <a href="javascript:void(0)"><i class="lni lni-twitter-original"></i></a>
                                </li>
                                <li>
                                    <a href="javascript:void(0)"><i class="lni lni-instagram"></i></a>
                                </li>
                                <li>
                                    <a href="javascript:void(0)"><i class="lni lni-skype"></i></a>
                                </li>
                            </ul>
                        </div>
                        <!-- End Nav Social -->
                    </div>
                </div>
            </div>
            <!-- End Header Bottom -->
        </header>
        <!-- End Header Area -->

        <!-- Start Breadcrumbs -->
        <div class="breadcrumbs">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-6 col-md-6 col-12">
                        <div class="breadcrumbs-content">
                            <h1 class="page-title">优惠券领取</h1>
                        </div>
                    </div>
                    <div class="col-lg-6 col-md-6 col-12">
                        <ul class="breadcrumb-nav">
                            <li><a href="index.html"><i class="lni lni-home"></i> 首页</a></li>
                            <li><a href="javascript:void(0)">商店</a></li>
                            <li>优惠券领取</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Breadcrumbs -->

        <!-- Shopping Cart -->
        <div class="shopping-cart section">
            <div class="container">
                <div class="cart-list-head" style="max-height: 1000px;overflow: auto;">
                    <!-- Cart List Title -->
                    <div class="cart-list-title">
                        <div class="coupon" v-for="(item,index) in couponList">
                            <h3>优惠券代码: <span id="couponCode">{{item.code}}</span></h3>
                            <p>折扣: <span id="couponDiscount">{{usageLimitText(item)}}，{{discountText(item)}}</span></p>
                            <p>有效期至: <span id="couponExpiration">{{item.expiration_date}}</span></p>
                            <button @click="Coupon(item.id)" v-if="item.status=='active'">领取优惠券</button>
                            <button v-else disabled="true">已领取</button>
                        </div>
                    </div>
                    <!-- End Cart List Title -->
                    
                </div>
            </div>
        </div>
        <!--/ End Shopping Cart -->

        <!-- Start Footer Area -->
        <footer class="footer">
            <div class="footer-middle">
                <div class="container">
                    <div class="bottom-inner">
                        <div class="row">
                            <div class="col-lg-3 col-md-6 col-12">
                                <!-- Single Widget -->
                                <div class="single-footer f-contact">
                                    <h3>与我们取得联系</h3>
                                    <p class="phone">电话: {{phone}}</p>
                                    <ul>
                                        <li><span>周一至周五: </span> 9.00 am - 8.00 pm</li>
                                        <li><span>星期六: </span> 10.00 am - 6.00 pm</li>
                                    </ul>
                                    <p class="mail">
                                        <a href="mailto:support@shopgrids.com">{{qq}}@qq.com</a>
                                    </p>
                                </div>
                                <!-- End Single Widget -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End Footer Middle -->
        </footer>
        <!--/ End Footer Area -->

        <!-- ========================= scroll-top ========================= -->
        <a href="#" class="scroll-top">
            <i class="lni lni-chevron-up"></i>
        </a>
    </div>

    <!-- ========================= JS here ========================= -->
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/tiny-slider.js"></script>
    <script src="assets/js/glightbox.min.js"></script>
    <script src="assets/js/main.js"></script>
</body>


<script src="assets/js/axios-0.18.0.js"></script>
<script src="assets/js/vue.js"></script>
<script>
    var app = new Vue({
        el:"#app",
        data:{
            isLogin:false,

            userId:'',
            username:'',
            cart:{},
            searchItem:'',//搜索用的
            history:[],//历史记录

            //字典
            phone:'',
            qq:'',

            //联想
            associationList:'',

            couponList:[],
        },
        computed: {
        },
        methods:{
            usageLimitText(item) {
                return `满${item.usage_limit.slice(1)}`;
            },
            discountText(item) {
                return '减'+(item.discount+"").slice(1);
            },
            //领券
            Coupon(id){
                var params = new URLSearchParams();
                params.append("coupon_id",id);
                axios.post("coupon.action?op=coupon",params).then(res=>{
                    if (res.data.code==0){
                        alert(res.data.error);
                    }else{
                    }

                    //刷新一下
                    this.getCoupon().then(result3=>{
                        if (result3.data.code==0){

                        }else{
                            this.couponList = result3.data.obj;
                        }
                    })
                })
            },
            //联想
            association(){
                if (this.searchItem==''){
                    this.associationList={};
                    return;
                }
                var params = new URLSearchParams();
                params.append("association",this.searchItem);
                axios.post("item.action?op=association",params).then(result=>{
                    if (result.data.code==1){
                        this.associationList = result.data.obj;
                    }
                })
            },
            //联想查询
            iSearch(item){
                window.location.href = `product-grids.html?searchItem=${item}`;
            },
            //根据id删记录
            delHistoryById(id){
                axios.post("item.action?op=delHistoryById&id="+id).then(result=>{
                    if (result.data.code==0){
                        alert("异常，删除失败")
                    }else{
                        //刷新一下
                        this.getHistory().then(result=>{
                            if (result.data.code==0){

                            }else{
                                this.history = result.data.obj;
                            }
                        })
                    }
                })
            },
            //清空记录
            clearHistory(){
                if(this.isLogin==false){
                    alert("未登录");
                    return;
                }
                axios.post("item.action?op=clearHistory").then(result=>{
                    if (result.data.code==0){
                        alert("删除异常")
                    }else{
                        alert("删除成功");
                        //刷新用的
                        this.getHistory().then(result=>{
                            if (result.data.code==0){

                            }else{
                                this.history = result.data.obj;
                            }
                        })
                    }
                })
            },
            //搜索    按名字或类型
            search(){
                window.location.href = `product-grids.html?searchItem=${this.searchItem}`;
            },
            //移除商品
            removeItem(id){
                var params = new URLSearchParams();
                params.append('id',id);
                axios.post("item.action?op=removeItemById",params).then(result=>{
                    if (result.data.code==0){
                        alert("移除异常,"+result.data.error);
                    }else{
                        alert("移除成功");
                        //刷新购物车
                        this.getCart().then(result=>{
                            if (result.data.code==0){
                                alert("购物车异常");
                            }else{
                                this.cart = result.data.obj || {};
                            }
                        })
                    }
                })
            },
            //登出
            logout(){
                axios("user.action?op=logout").then(result=>{
                    if (result.data.code==0){
                        this.isLogin=false;
                    }else{
                        this.isLogin=false;
                    }
                    //刷新购物车
                    this.getCart().then(result=>{
                        if (result.data.code==0){
                            alert("购物车异常");
                        }else{
                            this.cart = result.data.obj || {};
                        }
                    })
                })
            },
            getCart(){
                //查询购物车
                return axios.post("item.action?op=getCart")
            },
            checkLogin(){
                return axios.post("user.action?op=checkLogin")
            },
            getHistory(){
                return axios.post("item.action?op=getHistory");
            },
            normal(){   //数据字典啥的，比如电话，qq啥的
                return axios.post("normal.action?op=normal");
            },
            //获取能领的优惠券
            getCoupon(){
                return axios.post("coupon.action?op=getCoupons");
            }
        },
        mounted(){
            axios.all([this.getCart(),this.checkLogin(),this.getHistory(),this.getCoupon()]).then(axios.spread((result1,result2,result4,result3)=>{
                if (result1.data.code==0){
                    alert("购物车异常");
                }else{
                    this.cart = result1.data.obj || {};
                }

                if (result2.data.code==0){
                    this.isLogin = false;
                }else{
                    this.isLogin = true;
                    this.userId = result2.data.obj.id;
                    this.username = result2.data.obj.accountname;
                }
                if (result4.data.code==0){

                }else{
                    this.history = result4.data.obj;
                }

                if (result3.data.code==0){

                }else{
                    this.couponList = result3.data.obj;
                }
            }))

            this.normal().then(result=>{
                if (result.data.code==1){
                    result.data.obj.forEach(s=>{
                        if (s.recorde_name=="phone"){
                            this.phone = s.recorde_value;
                        }
                        if (s.recorde_name=="QQ"){
                            this.qq=s.recorde_value;
                        }
                    })
                }
            })
        }
    });
</script>

</html>